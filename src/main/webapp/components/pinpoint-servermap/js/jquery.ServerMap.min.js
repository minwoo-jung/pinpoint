/*! servermap - v0.0.1 - 2013-07-18 */!function(a,b){"use strict";a.ServerMap=$.Class({$init:function(a){this.option({sContainerId:"",sBigFont:"12pt Helvetica, Arial, sans-serif",sSmallFont:"11pt Helvetica, Arial, sans-serif",htNodeBackgroundColor:{0:"rgba(136, 194, 251, 0)",.5:"rgba(64, 169, 253, 0.1)",1:"rgba(122, 231, 255, 0)"},sImageDir:"./images/",htIcons:{APACHE:"APACHE.png",ARCUS:"ARCUS.png",CUBRID:"CUBRID.png",ETC:"ETC.png",MEMCACHED:"MEMCACHED.png",MYSQL:"MYSQL.png",QUEUE:"QUEUE.png",TOMCAT:"TOMCAT.png",UNKNOWN_CLOUD:"UNKNOWN_CLOUD.png",USER:"USER.png"},htLinkType:{sRouting:"AvoidsNodes",sCurve:"JumpGap"},htLinkTheme:{"default":{background:{0:"rgb(240, 240, 240)",.3:"rgb(240, 240, 240)",1:"rgba(240, 240, 240, 1)"},border:"gray",font:"10pt helvetica, arial, sans-serif",color:"#919191",align:"center",margin:1},good:{background:{0:"rgb(240, 1, 240)",.3:"rgb(240, 1, 240)",1:"rgba(240, 1, 240, 1)"},border:"green",font:"10pt helvetica, arial, sans-serif",color:"#919191",align:"center",margin:1},bad:{background:{0:"rgb(1, 240, 240)",.3:"rgb(1, 240, 240)",1:"rgba(1, 240, 240, 1)"},border:"red",font:"10pt helvetica, arial, sans-serif",color:"#919191",align:"center",margin:1}},htHighlightNode:{normal:{stroke:"gray",strokeWidth:1},to:{stroke:"#28a1f7",strokeWidth:1},from:{stroke:"#f77128",strokeWidth:1}},htHighlightLink:{normal:{stroke:"gray",strokeWidth:1},to:{stroke:"#28a1f7",strokeWidth:1},from:{stroke:"#f77128",strokeWidth:1}},fOnNodeClick:function(a,b){console.log("fOnNodeClick",a,b)},fOnLinkClick:function(a,b){console.log("fOnLinkClick",a,b)},fOnNodeContextClick:function(a,b){console.log("fOnNodeContextClick",a,b)},fOnLinkContextClick:function(a,b){console.log("fOnLinkContextClick",a,b)}}),this.option(a),this._initVariables(),this._initNodeTemplates(),this._initLinkTemplates(),this._initDiagramEnvironment()},_initVariables:function(){this.$=b.GraphObject.make,this._oDiagram=this.$(b.Diagram,this.option("sContainerId"),{initialContentAlignment:b.Spot.Center,maxSelectionCount:1}),this._oNodeBackground=this.$(b.Brush,b.Brush.Linear,this.option("htNodeBackgroundColor"))},_initNodeTemplates:function(){var a=this.option("sImageDir"),c=this.option("htIcons");this._oDefaultAdornment=this.$(b.Adornment,b.Panel.Auto,this.$(b.Shape,"Rectangle",{fill:null,stroke:"green",strokeWidth:3}),this.$(b.Placeholder)),this._oDiagram.nodeTemplate=this.$(b.Node,b.Panel.Auto,{selectionAdornmentTemplate:this._oDefaultAdornment,click:this._onNodeClick.bind(this),contextClick:this._onNodeContextClick.bind(this)},this.$(b.Shape,new b.Binding("figure","fig"),{name:"NODE",fill:this._oNodeBackground,stroke:"gray",portId:"",cursor:"pointer"}),this.$(b.Panel,b.Panel.Horizontal,{margin:4},this.$(b.Picture,{source:a+"UNKNOWN_CLOUD.png",width:20,height:20,margin:1,imageStretch:b.GraphObject.Uniform}),this.$(b.TextBlock,{margin:6,font:this.option("sBigFont"),editable:!1,text:"UNKNOWN_CLOUD"},new b.Binding("text","text").makeTwoWay()))),_.each(c,function(c,d){this._oDiagram.nodeTemplateMap.add(d,this.$(b.Node,b.Panel.Auto,{selectionAdornmentTemplate:this._oDefaultAdornment,click:this._onNodeClick.bind(this),contextClick:this._onNodeContextClick.bind(this)},this.$(b.Shape,new b.Binding("figure","fig"),{name:"NODE",fill:this._oNodeBackground,stroke:"gray",portId:"",cursor:"pointer"}),this.$(b.Panel,b.Panel.Horizontal,{margin:4},this.$(b.Picture,{source:a+c,width:20,height:20,margin:1,imageStretch:b.GraphObject.Uniform}),this.$(b.TextBlock,{margin:6,font:this.option("sBigFont"),editable:!1,text:d},new b.Binding("text","text").makeTwoWay()))))},this)},_initLinkTemplates:function(){var a=this.option("htLinkType"),c={selectionAdorned:!0,click:this._onLinkClick.bind(this),contextClick:this._onLinkContextClick.bind(this),layerName:"Foreground",reshapable:!0,fromSpot:b.Spot.RightSide,toSpot:b.Spot.LeftSide,routing:b.Link[a.sRouting],corner:10,curve:b.Link[a.sCurve]},d=this.option("htLinkTheme"),e=d.default;this._oDiagram.linkTemplate=this.$(b.Link,c,new b.Binding("curviness","curviness"),this.$(b.Shape,{name:"LINK",isPanelMain:!0,stroke:"gray",strokeWidth:1.5}),this.$(b.Shape,{toArrow:"standard",fill:"#2F4F4F",stroke:null,scale:1.5}),this.$(b.Panel,b.Panel.Auto,this.$(b.Shape,"RoundedRectangle",{name:"LINK2",fill:this.$(b.Brush,b.Brush.Linear,e.background),stroke:e.border,portId:"",fromLinkable:!0,toLinkable:!0,cursor:"pointer"}),this.$(b.TextBlock,{textAlign:e.align,font:e.font,stroke:e.color,margin:e.margin},new b.Binding("text","text")))),_.each(d,function(a,d){"default"!==d&&this._oDiagram.linkTemplateMap.add(d,this.$(b.Link,c,new b.Binding("curviness","curviness"),this.$(b.Shape,{name:"LINK",isPanelMain:!0,stroke:"gray",strokeWidth:1.5}),this.$(b.Shape,{toArrow:"standard",fill:"#2F4F4F",stroke:null,scale:1.5}),this.$(b.Panel,b.Panel.Auto,this.$(b.Shape,"RoundedRectangle",{fill:this.$(b.Brush,b.Brush.Linear,a.background),stroke:a.border,portId:"",fromLinkable:!0,toLinkable:!0,cursor:"pointer"}),this.$(b.TextBlock,{textAlign:a.align,font:a.font,stroke:a.color,margin:a.margin},new b.Binding("text","text")))))},this)},_initDiagramEnvironment:function(){this._oDiagram.toolManager.mouseWheelBehavior=b.ToolManager.WheelZoom,this._oDiagram.allowDrop=!1,this._oDiagram.initialAutoScale=b.Diagram.Uniform,this._oDiagram.toolManager.draggingTool.doCancel(),this._oDiagram.toolManager.draggingTool.doDeactivate(),this._oDiagram.initialContentAlignment=b.Spot.Center,this._oDiagram.layout=this.$(b.LayeredDigraphLayout,{isOngoing:!1,layerSpacing:150,columnSpacing:50,setsPortSpots:!1});var a=this;this._oDiagram.addDiagramListener("ChangedSelection",function(){a._updateHightlights()})},load:function(a){this._oDiagram.model=b.Model.fromJson(a),this._oDiagram.undoManager.isEnabled=!0},clear:function(){this._oDiagram.model=b.Model.fromJson({})},_resetHighlights:function(){for(var a=this._oDiagram.nodes,b=this._oDiagram.links;a.next();)a.value.highlight="normal";for(;b.next();)b.value.highlight="normal"},_updateHightlights:function(a){this._resetHighlights(),a=a||this._oDiagram.selection.first(),null!==a&&(a instanceof b.Node?(this._linksTo(a,"to"),this._linksFrom(a,"from")):a instanceof b.Link&&(this._nodesTo(a,"to"),this._nodesFrom(a,"from")));for(var c=this._oDiagram.nodes,d=this._oDiagram.links;c.next();){var e=c.value.findObject("NODE"),f=c.value.highlight;this._highlight("node",e,f)}for(;d.next();){var g=d.value.findObject("LINK"),h=d.value.findObject("LINK2"),i=d.value.highlight;this._highlight("link",g,i),this._highlight("link",h,i)}},highlightNodeByKey:function(a){var b=this._oDiagram.findNodeForKey(a);if(b){var c=this._oDiagram.findPartForKey(a);this._oDiagram.select(c),this._updateHightlights(b)}},highlightLinkByFromTo:function(a,b){var c=this._getLinkObjectByFromTo(a,b);if(c){var d=this._oDiagram.findLinkForData(c),e=this._oDiagram.findPartForData(c);this._oDiagram.select(e),this._updateHightlights(d)}},_getLinkObjectByFromTo:function(a,b){for(var c=this._oDiagram.model.linkDataArray,d=0,e=c.length;e>d;d+=1){var f=c[d];if(f.from===a&&f.to===b)return f}return!1},_highlight:function(a,b,c){var d;"node"===a?d=this.option("htHighlightNode"):"link"===a&&(d=this.option("htHighlightLink")),null!==b&&d[c]&&(b.stroke=d[c].stroke,b.strokeWidth=parseInt(d[c].strokeWidth,10))},_linksTo:function(a,c){if(a instanceof b.Node)for(var d=a.findLinksInto();d.next();)d.value.highlight=c},_linksFrom:function(a,c){if(a instanceof b.Node)for(var d=a.findLinksOutOf();d.next();)d.value.highlight=c},_nodesTo:function(a,c){var d=new b.List("string");if(a instanceof b.Link)a.fromNode.highlight=c,d.add(a.data.from);else for(var e=a.findNodesInto();e.next();)e.value.highlight=c,d.add(e.value.data.key);return d},_nodesFrom:function(a,c){var d=new b.List("string");if(a instanceof b.Link)a.toNode.highlight=c,d.add(a.data.to);else for(var e=a.findNodesOutOf();e.next();)e.value.highlight=c,d.add(e.value.data.key);return d},_onNodeClick:function(a,b){var c=b.part,d=c.data,e=this.option("fOnNodeClick");_.isFunction(e)&&e.call(this,a.Vi,d)},_onNodeContextClick:function(a,b){var c=b.part,d=c.data,e=this.option("fOnNodeContextClick");_.isFunction(e)&&e.call(this,a.Vi,d)},_onLinkClick:function(a,b){var c=b.part,d=c.data,e=this.option("fOnLinkClick");_.isFunction(e)&&e.call(this,a.Vi,d)},_onLinkContextClick:function(a,b){var c=b.part,d=c.data,e=this.option("fOnLinkContextClick");_.isFunction(e)&&e.call(this,a.Vi,d)}})}(window,go);