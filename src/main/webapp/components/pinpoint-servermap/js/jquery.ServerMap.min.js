/*! servermap - v0.0.1 - 2013-09-08 */!function(a,b,c,d){"use strict";a.ServerMap=c.Class({$init:function(a){this.option({sContainerId:"",sBigFont:"12pt NanumGothic,ng,dotum,AppleGothic,avn55,sans-serif",sSmallFont:"11pt NanumGothic,ng,dotum,AppleGothic,avn55,sans-serif",sImageDir:"./images/",nBoldKey:null,htIcons:{APACHE:"APACHE.png",ARCUS:"ARCUS.png",CUBRID:"CUBRID.png",ETC:"ETC.png",MEMCACHED:"MEMCACHED.png",MYSQL:"MYSQL.png",QUEUE:"QUEUE.png",TOMCAT:"TOMCAT.png",UNKNOWN_CLOUD:"UNKNOWN_CLOUD.png",USER:"USER.png"},htNodeTheme:{"default":{backgroundColor:"#ffffff",borderColor:"#adadad",fontColor:"#333333"},bold:{borderColor:"#d43f3a"}},htLinkType:{sRouting:"AvoidsNodes",sCurve:"JumpGap"},htLinkTheme:{"default":{backgroundColor:"rgb(240, 240, 240)",borderColor:"#7d7d7d",fontFamily:"10pt helvetica, arial, sans-serif",fontColor:"#919191",fontAlign:"center",margin:1},good:{backgroundColor:"rgb(240, 1, 240)",borderColor:"#7d7d7d",fontFamily:"10pt helvetica, arial, sans-serif",fontColor:"#919191",fontAlign:"center",margin:1},bad:{backgroundColor:"rgb(1, 240, 240)",borderColor:"#7d7d7d",fontFamily:"10pt helvetica, arial, sans-serif",fontColor:"#919191",fontAlign:"center",margin:1}},htHighlightNode:{self:{backgroundColor:"#f0ad4e"},to:{backgroundColor:"#28a1f7"},from:{backgroundColor:"#f77128"}},htHighlightLink:{self:{borderColor:"#eea236"},to:{borderColor:"#28a1f7"},from:{borderColor:"#f77128"}},fOnNodeClicked:function(){},fOnNodeContextClicked:function(){},fOnLinkClicked:function(){},fOnLinkContextClicked:function(){},fOnBackgroundClicked:function(){},fOnBackgroundContextClicked:function(){}}),this.option(a),this._initVariables(),this._initNodeTemplates(),this._initLinkTemplates(),this._initDiagramEnvironment()},_initVariables:function(){this.$=b.GraphObject.make,this._oDiagram=this.$(b.Diagram,this.option("sContainerId"),{initialContentAlignment:b.Spot.Center,maxSelectionCount:1})},_initNodeTemplates:function(){var a=this,c=this.option("sImageDir"),e=this.option("htIcons");this.$(b.Adornment,b.Panel.Auto,this.$(b.Shape,new b.Binding("figure","fig"),{fill:null,stroke:"#629b58",strokeWidth:1}),this.$(b.Placeholder));var f=function(){return a.option("htNodeTheme")["default"].backgroundColor},g=function(b){var c="default";return a.option("nBoldKey")&&a.option("nBoldKey")===b&&(c="bold"),a.option("htNodeTheme")[c].borderColor},h=function(){return a.option("htNodeTheme")["default"].fontColor},i=function(d){return a.$(b.Node,b.Panel.Auto,{selectionAdorned:!1,click:a._onNodeClicked.bind(a),contextClick:a._onNodeContextClicked.bind(a)},a.$(b.Shape,new b.Binding("figure","fig"),new b.Binding("fill","key",f),new b.Binding("stroke","key",g),{name:"NODE",portId:"",cursor:"pointer",strokeWidth:2}),a.$(b.Panel,b.Panel.Horizontal,{margin:4},a.$(b.Picture,{source:c+d,width:20,height:20,margin:1,imageStretch:b.GraphObject.Uniform}),a.$(b.TextBlock,{margin:6,font:a.option("sBigFont"),editable:!1},new b.Binding("stroke","key",h),new b.Binding("text","text").makeTwoWay())))};this._oDiagram.nodeTemplate=i("UNKNOWN_CLOUD.png"),d.each(e,function(a,b){this._oDiagram.nodeTemplateMap.add(b,i(a))},this)},_initLinkTemplates:function(){var a=this,c=this.option("htLinkType"),e={selectionAdorned:!1,click:this._onLinkClicked.bind(this),contextClick:this._onLinkContextClicked.bind(this),layerName:"Foreground",reshapable:!0,fromSpot:b.Spot.RightSide,toSpot:b.Spot.LeftSide,routing:b.Link[c.sRouting],corner:10,curve:b.Link[c.sCurve]},f=this.option("htLinkTheme"),g=f.default,h=function(c){return a.$(b.Link,e,new b.Binding("curviness","curviness"),a.$(b.Shape,{name:"LINK",isPanelMain:!0,stroke:c.borderColor,strokeWidth:1.5}),a.$(b.Shape,{toArrow:"standard",fill:"#2F4F4F",stroke:null,scale:1.5}),a.$(b.Panel,b.Panel.Auto,a.$(b.Shape,"RoundedRectangle",{name:"LINK2",fill:c.backgroundColor,stroke:c.borderColor,portId:"",fromLinkable:!0,toLinkable:!0,cursor:"pointer"}),a.$(b.TextBlock,{textAlign:c.fontAlign,font:c.fontFamily,stroke:c.fontColor,margin:c.margin},new b.Binding("text","text",function(a){return Number(a,10).toLocaleString()}))))};this._oDiagram.linkTemplate=h(g),d.each(f,function(a,b){"default"!==b&&this._oDiagram.linkTemplateMap.add(b,h(a))},this)},_initDiagramEnvironment:function(){this._oDiagram.toolManager.mouseWheelBehavior=b.ToolManager.WheelZoom,this._oDiagram.allowDrop=!1,this._oDiagram.initialAutoScale=b.Diagram.Uniform,this._oDiagram.toolManager.draggingTool.doCancel(),this._oDiagram.toolManager.draggingTool.doDeactivate(),this._oDiagram.initialContentAlignment=b.Spot.Center,this._oDiagram.layout=this.$(b.LayeredDigraphLayout,{isOngoing:!1,layerSpacing:150,columnSpacing:50,setsPortSpots:!1});var a=this;this._oDiagram.addDiagramListener("ChangedSelection",function(){a._updateHightlights()}),this._oDiagram.addDiagramListener("BackgroundSingleClicked",function(b){var c=a.option("fOnBackgroundClicked");d.isFunction(c)&&c.call(a,b)}),this._oDiagram.addDiagramListener("BackgroundContextClicked",function(b){var c=a.option("fOnBackgroundContextClicked");d.isFunction(c)&&c.call(a,b)})},load:function(a){this._oDiagram.model=b.Model.fromJson(a),this._oDiagram.undoManager.isEnabled=!0,this.option("nBoldKey")&&this.highlightNodeByKey(this.option("nBoldKey"))},clear:function(){this._oDiagram.model=b.Model.fromJson({})},_resetHighlights:function(){for(var a=this._oDiagram.nodes,b=this._oDiagram.links;a.next();)a.value.highlight=!1;for(;b.next();)b.value.highlight=!1},_updateHightlights:function(a){if(a=a||this._oDiagram.selection.first(),null!==a){this._resetHighlights(),a.highlight="self",a instanceof b.Node?(this._linksTo(a,"to"),this._linksFrom(a,"from")):a instanceof b.Link&&(this._nodesTo(a,"to"),this._nodesFrom(a,"from"));for(var c=this._oDiagram.nodes,d=this._oDiagram.links;c.next();)this._hightlightNode(c.value.findObject("NODE"),c.value.highlight);for(;d.next();)this._highlightLink(d.value.findObject("LINK"),d.value.highlight),this._highlightLink(d.value.findObject("LINK2"),d.value.highlight)}},highlightNodeByKey:function(a){var b=this._oDiagram.findNodeForKey(a);if(b){var c=this._oDiagram.findPartForKey(a);this._oDiagram.select(c),this._updateHightlights(b)}},highlightLinkByFromTo:function(a,b){var c=this._getLinkObjectByFromTo(a,b);c&&(this._oDiagram.select(this._oDiagram.findPartForData(c)),this._updateHightlights(this._oDiagram.findLinkForData(c)))},_getLinkObjectByFromTo:function(a,b){for(var c=this._oDiagram.model.linkDataArray,d=0,e=c.length;e>d;d+=1){var f=c[d];if(f.from===a&&f.to===b)return f}return!1},_hightlightNode:function(a,b){null!==a&&(a.fill=b?this.option("htHighlightNode")[b].backgroundColor:this.option("htNodeTheme").default.backgroundColor)},_highlightLink:function(a,b){null!==a&&(a.stroke=b?this.option("htHighlightLink")[b].borderColor:this.option("htLinkTheme").default.borderColor)},_linksTo:function(a,c){if(a instanceof b.Node)for(var d=a.findLinksInto();d.next();)d.value.highlight=c},_linksFrom:function(a,c){if(a instanceof b.Node)for(var d=a.findLinksOutOf();d.next();)d.value.highlight=c},_nodesTo:function(a,c){var d=new b.List("string");if(a instanceof b.Link)a.fromNode.highlight=c,d.add(a.data.from);else for(var e=a.findNodesInto();e.next();)e.value.highlight=c,d.add(e.value.data.key);return d},_nodesFrom:function(a,c){var d=new b.List("string");if(a instanceof b.Link)a.toNode.highlight=c,d.add(a.data.to);else for(var e=a.findNodesOutOf();e.next();)e.value.highlight=c,d.add(e.value.data.key);return d},_onNodeClicked:function(a,b){var c=b.part,e=c.data,f=this.option("fOnNodeClicked");d.isFunction(f)&&f.call(this,a,e)},_onNodeContextClicked:function(a,b){var c=b.part,e=c.data,f=this.option("fOnNodeContextClicked");d.isFunction(f)&&f.call(this,a,e)},_onLinkClicked:function(a,b){var c=b.part,e=c.data,f=this.option("fOnLinkClicked");d.isFunction(f)&&f.call(this,a,e)},_onLinkContextClicked:function(a,b){var c=b.part,e=c.data,f=this.option("fOnLinkContextClicked");d.isFunction(f)&&f.call(this,a,e)}})}(window,go,jQuery,_);