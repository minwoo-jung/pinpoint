/*! servermap - v0.0.1 - 2013-09-02 */!function(a,b){"use strict";a.ServerMap=$.Class({$init:function(a){this.option({sContainerId:"",sBigFont:"12pt Helvetica, Arial, sans-serif",sSmallFont:"11pt Helvetica, Arial, sans-serif",sImageDir:"./images/",nBoldKey:null,htIcons:{APACHE:"APACHE.png",ARCUS:"ARCUS.png",CUBRID:"CUBRID.png",ETC:"ETC.png",MEMCACHED:"MEMCACHED.png",MYSQL:"MYSQL.png",QUEUE:"QUEUE.png",TOMCAT:"TOMCAT.png",UNKNOWN_CLOUD:"UNKNOWN_CLOUD.png",USER:"USER.png"},htNodeTheme:{"default":{fill:{0:"#fafafa",.5:"#f3f3f3",1:"#ededed"},stroke:"#d5d5d5",color:"#707070"},bold:{fill:{0:"#84CA5F",1:"#69aa46"},stroke:"#579636",color:"white"}},htLinkType:{sRouting:"AvoidsNodes",sCurve:"JumpGap"},htLinkTheme:{"default":{background:{0:"rgb(240, 240, 240)",.3:"rgb(240, 240, 240)",1:"rgba(240, 240, 240, 1)"},border:"gray",font:"10pt helvetica, arial, sans-serif",color:"#919191",align:"center",margin:1},good:{background:{0:"rgb(240, 1, 240)",.3:"rgb(240, 1, 240)",1:"rgba(240, 1, 240, 1)"},border:"green",font:"10pt helvetica, arial, sans-serif",color:"#919191",align:"center",margin:1},bad:{background:{0:"rgb(1, 240, 240)",.3:"rgb(1, 240, 240)",1:"rgba(1, 240, 240, 1)"},border:"red",font:"10pt helvetica, arial, sans-serif",color:"#919191",align:"center",margin:1}},htHighlightNode:{"default":{stroke:"#d5d5d5",strokeWidth:1},to:{stroke:"#28a1f7",strokeWidth:1},from:{stroke:"#f77128",strokeWidth:1}},htHighlightLink:{"default":{stroke:"#d5d5d5",strokeWidth:1},to:{stroke:"#28a1f7",strokeWidth:1},from:{stroke:"#f77128",strokeWidth:1}},fOnNodeClicked:function(){},fOnNodeContextClicked:function(){},fOnLinkClicked:function(){},fOnLinkContextClicked:function(){},fOnBackgroundClicked:function(){},fOnBackgroundContextClicked:function(){}}),this.option(a),this._initVariables(),this._initNodeTemplates(),this._initLinkTemplates(),this._initDiagramEnvironment()},_initVariables:function(){this.$=b.GraphObject.make,this._oDiagram=this.$(b.Diagram,this.option("sContainerId"),{initialContentAlignment:b.Spot.Center,maxSelectionCount:1})},_initNodeTemplates:function(){var a=this,c=this.option("sImageDir"),d=this.option("htIcons"),e=this.$(b.Adornment,b.Panel.Auto,this.$(b.Shape,new b.Binding("figure","fig"),{fill:null,stroke:"#629b58",strokeWidth:1}),this.$(b.Placeholder)),f=function(c){var d="default";return a.option("nBoldKey")&&a.option("nBoldKey")===c&&(d="bold"),a.$(b.Brush,b.Brush.Linear,a.option("htNodeTheme")[d].fill)},g=function(b){var c="default";return a.option("nBoldKey")&&a.option("nBoldKey")===b&&(c="bold"),a.option("htNodeTheme")[c].stroke},h=function(b){var c="default";return a.option("nBoldKey")&&a.option("nBoldKey")===b&&(c="bold"),a.option("htNodeTheme")[c].color};this._oDiagram.nodeTemplate=this.$(b.Node,b.Panel.Auto,{selectionAdornmentTemplate:e,click:this._onNodeClicked.bind(this),contextClick:this._onNodeContextClicked.bind(this)},this.$(b.Shape,new b.Binding("figure","fig"),new b.Binding("fill","key",f),new b.Binding("stroke","key",g),{name:"NODE",portId:"",cursor:"pointer"}),this.$(b.Panel,b.Panel.Horizontal,{margin:4},this.$(b.Picture,{source:c+"UNKNOWN_CLOUD.png",width:20,height:20,margin:1,imageStretch:b.GraphObject.Uniform}),this.$(b.TextBlock,{margin:6,font:this.option("sBigFont"),editable:!1,text:"UNKNOWN_CLOUD"},new b.Binding("stroke","key",h),new b.Binding("text","text").makeTwoWay()))),_.each(d,function(a,d){this._oDiagram.nodeTemplateMap.add(d,this.$(b.Node,b.Panel.Auto,{selectionAdornmentTemplate:e,click:this._onNodeClicked.bind(this),contextClick:this._onNodeContextClicked.bind(this)},this.$(b.Shape,new b.Binding("figure","fig"),new b.Binding("fill","key",f),new b.Binding("stroke","key",g),{name:"NODE",portId:"",stroke:this.option("htHighlightNode").default.stroke,cursor:"pointer"}),this.$(b.Panel,b.Panel.Horizontal,{margin:4},this.$(b.Picture,{source:c+a,width:20,height:20,margin:1,imageStretch:b.GraphObject.Uniform}),this.$(b.TextBlock,{margin:6,font:this.option("sBigFont"),editable:!1,text:d},new b.Binding("stroke","key",h),new b.Binding("text","text").makeTwoWay()))))},this)},_initLinkTemplates:function(){var a=this.option("htLinkType"),c={selectionAdorned:!0,click:this._onLinkClicked.bind(this),contextClick:this._onLinkContextClicked.bind(this),layerName:"Foreground",reshapable:!0,fromSpot:b.Spot.RightSide,toSpot:b.Spot.LeftSide,routing:b.Link[a.sRouting],corner:10,curve:b.Link[a.sCurve]},d=this.option("htLinkTheme"),e=d.default;this._oDiagram.linkTemplate=this.$(b.Link,c,new b.Binding("curviness","curviness"),this.$(b.Shape,{name:"LINK",isPanelMain:!0,stroke:this.option("htHighlightLink").default.stroke,strokeWidth:1.5}),this.$(b.Shape,{toArrow:"standard",fill:"#2F4F4F",stroke:null,scale:1.5}),this.$(b.Panel,b.Panel.Auto,this.$(b.Shape,"RoundedRectangle",{name:"LINK2",fill:this.$(b.Brush,b.Brush.Linear,e.background),stroke:e.border,portId:"",fromLinkable:!0,toLinkable:!0,cursor:"pointer"}),this.$(b.TextBlock,{textAlign:e.align,font:e.font,stroke:e.color,margin:e.margin},new b.Binding("text","text")))),_.each(d,function(a,d){"default"!==d&&this._oDiagram.linkTemplateMap.add(d,this.$(b.Link,c,new b.Binding("curviness","curviness"),this.$(b.Shape,{name:"LINK",isPanelMain:!0,stroke:this.option("htHighlightLink").default.stroke,strokeWidth:1.5}),this.$(b.Shape,{toArrow:"standard",fill:"#2F4F4F",stroke:null,scale:1.5}),this.$(b.Panel,b.Panel.Auto,this.$(b.Shape,"RoundedRectangle",{fill:this.$(b.Brush,b.Brush.Linear,a.background),stroke:a.border,portId:"",fromLinkable:!0,toLinkable:!0,cursor:"pointer"}),this.$(b.TextBlock,{textAlign:a.align,font:a.font,stroke:a.color,margin:a.margin},new b.Binding("text","text")))))},this)},_initDiagramEnvironment:function(){this._oDiagram.toolManager.mouseWheelBehavior=b.ToolManager.WheelZoom,this._oDiagram.allowDrop=!1,this._oDiagram.initialAutoScale=b.Diagram.Uniform,this._oDiagram.toolManager.draggingTool.doCancel(),this._oDiagram.toolManager.draggingTool.doDeactivate(),this._oDiagram.initialContentAlignment=b.Spot.Center,this._oDiagram.layout=this.$(b.LayeredDigraphLayout,{isOngoing:!1,layerSpacing:150,columnSpacing:50,setsPortSpots:!1});var a=this;this._oDiagram.addDiagramListener("ChangedSelection",function(){a._updateHightlights()}),this._oDiagram.addDiagramListener("BackgroundSingleClicked",function(b){var c=a.option("fOnBackgroundClicked");_.isFunction(c)&&c.call(a,b)}),this._oDiagram.addDiagramListener("BackgroundContextClicked",function(b){var c=a.option("fOnBackgroundContextClicked");_.isFunction(c)&&c.call(a,b)})},load:function(a){this._oDiagram.model=b.Model.fromJson(a),this._oDiagram.undoManager.isEnabled=!0},clear:function(){this._oDiagram.model=b.Model.fromJson({})},_resetHighlights:function(){for(var a=this._oDiagram.nodes,b=this._oDiagram.links;a.next();)a.value.highlight="default";for(;b.next();)b.value.highlight="default"},_updateHightlights:function(a){this._resetHighlights(),a=a||this._oDiagram.selection.first(),null!==a&&(a instanceof b.Node?(this._linksTo(a,"to"),this._linksFrom(a,"from")):a instanceof b.Link&&(this._nodesTo(a,"to"),this._nodesFrom(a,"from")));for(var c=this._oDiagram.nodes,d=this._oDiagram.links;c.next();){var e=c.value.findObject("NODE"),f=c.value.highlight;this._highlight("node",e,f)}for(;d.next();){var g=d.value.findObject("LINK"),h=d.value.findObject("LINK2"),i=d.value.highlight;this._highlight("link",g,i),this._highlight("link",h,i)}},highlightNodeByKey:function(a){var b=this._oDiagram.findNodeForKey(a);if(b){var c=this._oDiagram.findPartForKey(a);this._oDiagram.select(c),this._updateHightlights(b)}},highlightLinkByFromTo:function(a,b){var c=this._getLinkObjectByFromTo(a,b);if(c){var d=this._oDiagram.findLinkForData(c),e=this._oDiagram.findPartForData(c);this._oDiagram.select(e),this._updateHightlights(d)}},_getLinkObjectByFromTo:function(a,b){for(var c=this._oDiagram.model.linkDataArray,d=0,e=c.length;e>d;d+=1){var f=c[d];if(f.from===a&&f.to===b)return f}return!1},_highlight:function(a,b,c){var d;"node"===a?d=this.option("htHighlightNode"):"link"===a&&(d=this.option("htHighlightLink")),null!==b&&d[c]&&(b.stroke=d[c].stroke,b.strokeWidth=parseInt(d[c].strokeWidth,10))},_linksTo:function(a,c){if(a instanceof b.Node)for(var d=a.findLinksInto();d.next();)d.value.highlight=c},_linksFrom:function(a,c){if(a instanceof b.Node)for(var d=a.findLinksOutOf();d.next();)d.value.highlight=c},_nodesTo:function(a,c){var d=new b.List("string");if(a instanceof b.Link)a.fromNode.highlight=c,d.add(a.data.from);else for(var e=a.findNodesInto();e.next();)e.value.highlight=c,d.add(e.value.data.key);return d},_nodesFrom:function(a,c){var d=new b.List("string");if(a instanceof b.Link)a.toNode.highlight=c,d.add(a.data.to);else for(var e=a.findNodesOutOf();e.next();)e.value.highlight=c,d.add(e.value.data.key);return d},_onNodeClicked:function(a,b){var c=b.part,d=c.data,e=this.option("fOnNodeClicked");_.isFunction(e)&&e.call(this,a,d)},_onNodeContextClicked:function(a,b){var c=b.part,d=c.data,e=this.option("fOnNodeContextClicked");_.isFunction(e)&&e.call(this,a,d)},_onLinkClicked:function(a,b){var c=b.part,d=c.data,e=this.option("fOnLinkClicked");_.isFunction(e)&&e.call(this,a,d)},_onLinkContextClicked:function(a,b){var c=b.part,d=c.data,e=this.option("fOnLinkContextClicked");_.isFunction(e)&&e.call(this,a,d)}})}(window,go);