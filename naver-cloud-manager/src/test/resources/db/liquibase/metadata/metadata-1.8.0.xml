<?xml version="1.1" encoding="UTF-8" standalone="no"?>
<databaseChangeLog xmlns="http://www.liquibase.org/xml/ns/dbchangelog" xmlns:ext="http://www.liquibase.org/xml/ns/dbchangelog-ext" xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance" xsi:schemaLocation="http://www.liquibase.org/xml/ns/dbchangelog-ext http://www.liquibase.org/xml/ns/dbchangelog/dbchangelog-ext.xsd http://www.liquibase.org/xml/ns/dbchangelog http://www.liquibase.org/xml/ns/dbchangelog/dbchangelog-3.6.xsd">

    <!-- for spring batch job repository -->
    <changeSet author="metadata" id="metadata-1.8.0_1">
        <createTable tableName="BATCH_JOB_INSTANCE">
            <column name="JOB_INSTANCE_ID" type="BIGINT">
                <constraints primaryKey="true"/>
            </column>
            <column name="VERSION" type="BIGINT"/>
            <column name="JOB_NAME" type="VARCHAR(100)">
                <constraints nullable="false"/>
            </column>
            <column name="JOB_KEY" type="VARCHAR(32)">
                <constraints nullable="false"/>
            </column>
        </createTable>
    </changeSet>
    <changeSet author="metadata" id="metadata-1.8.0_2">
        <addUniqueConstraint columnNames="JOB_NAME, JOB_KEY" constraintName="JOB_INST_UN" tableName="BATCH_JOB_INSTANCE"/>
    </changeSet>

    <changeSet author="metadata" id="metadata-1.8.0_3">
        <createTable tableName="BATCH_JOB_EXECUTION">
            <column name="JOB_EXECUTION_ID" type="BIGINT">
                <constraints primaryKey="true"/>
            </column>
            <column name="VERSION" type="BIGINT"/>
            <column name="JOB_INSTANCE_ID" type="BIGINT">
                <constraints nullable="false"/>
            </column>
            <column name="CREATE_TIME" type="datetime">
                <constraints nullable="false"/>
            </column>
            <column name="START_TIME" type="datetime"/>
            <column name="END_TIME" type="datetime"/>
            <column name="STATUS" type="VARCHAR(10)"/>
            <column name="EXIT_CODE" type="VARCHAR(2500)"/>
            <column name="EXIT_MESSAGE" type="VARCHAR(2500)"/>
            <column name="LAST_UPDATED" type="datetime"/>
            <column name="JOB_CONFIGURATION_LOCATION" type="VARCHAR(2500)"/>
        </createTable>
    </changeSet>
    <changeSet author="metadata" id="metadata-1.8.0_4">
        <createIndex indexName="JOB_INST_EXEC_FK" tableName="BATCH_JOB_EXECUTION">
            <column name="JOB_INSTANCE_ID"/>
        </createIndex>
    </changeSet>
    <changeSet author="metadata" id="metadata-1.8.0_5">
        <addForeignKeyConstraint baseColumnNames="JOB_INSTANCE_ID" baseTableName="BATCH_JOB_EXECUTION" constraintName="JOB_INST_EXEC_FK" deferrable="false" initiallyDeferred="false" onDelete="NO ACTION" onUpdate="NO ACTION" referencedColumnNames="JOB_INSTANCE_ID" referencedTableName="BATCH_JOB_INSTANCE" validate="true"/>
    </changeSet>

    <changeSet author="metadata" id="metadata-1.8.0_6">
        <createTable tableName="BATCH_JOB_EXECUTION_PARAMS">
            <column name="JOB_EXECUTION_ID" type="BIGINT">
                <constraints nullable="false"/>
            </column>
            <column name="TYPE_CD" type="VARCHAR(6)">
                <constraints nullable="false"/>
            </column>
            <column name="KEY_NAME" type="VARCHAR(100)">
                <constraints nullable="false"/>
            </column>
            <column name="STRING_VAL" type="VARCHAR(250)"/>
            <column name="DATE_VAL" type="datetime"/>
            <column name="LONG_VAL" type="BIGINT"/>
            <column name="DOUBLE_VAL" type="DOUBLE"/>
            <column name="IDENTIFYING" type="CHAR(1)">
                <constraints nullable="false"/>
            </column>
        </createTable>
    </changeSet>
    <changeSet author="metadata" id="metadata-1.8.0_7">
        <createIndex indexName="JOB_EXEC_PARAMS_FK" tableName="BATCH_JOB_EXECUTION_PARAMS">
            <column name="JOB_EXECUTION_ID"/>
        </createIndex>
    </changeSet>
    <changeSet author="metadata" id="metadata-1.8.0_8">
        <addForeignKeyConstraint baseColumnNames="JOB_EXECUTION_ID" baseTableName="BATCH_JOB_EXECUTION_PARAMS" constraintName="JOB_EXEC_PARAMS_FK" deferrable="false" initiallyDeferred="false" onDelete="NO ACTION" onUpdate="NO ACTION" referencedColumnNames="JOB_EXECUTION_ID" referencedTableName="BATCH_JOB_EXECUTION" validate="true"/>
    </changeSet>

    <changeSet author="metadata" id="metadata-1.8.0_9">
        <createTable tableName="BATCH_STEP_EXECUTION">
            <column name="STEP_EXECUTION_ID" type="BIGINT">
                <constraints primaryKey="true"/>
            </column>
            <column name="VERSION" type="BIGINT">
                <constraints nullable="false"/>
            </column>
            <column name="STEP_NAME" type="VARCHAR(100)">
                <constraints nullable="false"/>
            </column>
            <column name="JOB_EXECUTION_ID" type="BIGINT">
                <constraints nullable="false"/>
            </column>
            <column name="START_TIME" type="datetime">
                <constraints nullable="false"/>
            </column>
            <column name="END_TIME" type="datetime"/>
            <column name="STATUS" type="VARCHAR(10)"/>
            <column name="COMMIT_COUNT" type="BIGINT"/>
            <column name="READ_COUNT" type="BIGINT"/>
            <column name="FILTER_COUNT" type="BIGINT"/>
            <column name="WRITE_COUNT" type="BIGINT"/>
            <column name="READ_SKIP_COUNT" type="BIGINT"/>
            <column name="WRITE_SKIP_COUNT" type="BIGINT"/>
            <column name="PROCESS_SKIP_COUNT" type="BIGINT"/>
            <column name="ROLLBACK_COUNT" type="BIGINT"/>
            <column name="EXIT_CODE" type="VARCHAR(2500)"/>
            <column name="EXIT_MESSAGE" type="VARCHAR(2500)"/>
            <column name="LAST_UPDATED" type="datetime"/>
        </createTable>
    </changeSet>
    <changeSet author="metadata" id="metadata-1.8.0_10">
        <createIndex indexName="JOB_EXEC_STEP_FK" tableName="BATCH_STEP_EXECUTION">
            <column name="JOB_EXECUTION_ID"/>
        </createIndex>
    </changeSet>
    <changeSet author="metadata" id="metadata-1.8.0_11">
        <addForeignKeyConstraint baseColumnNames="JOB_EXECUTION_ID" baseTableName="BATCH_STEP_EXECUTION" constraintName="JOB_EXEC_STEP_FK" deferrable="false" initiallyDeferred="false" onDelete="NO ACTION" onUpdate="NO ACTION" referencedColumnNames="JOB_EXECUTION_ID" referencedTableName="BATCH_JOB_EXECUTION" validate="true"/>
    </changeSet>

    <changeSet author="metadata" id="metadata-1.8.0_12">
        <createTable tableName="BATCH_STEP_EXECUTION_CONTEXT">
            <column name="STEP_EXECUTION_ID" type="BIGINT">
                <constraints primaryKey="true"/>
            </column>
            <column name="SHORT_CONTEXT" type="VARCHAR(2500)">
                <constraints nullable="false"/>
            </column>
            <column name="SERIALIZED_CONTEXT" type="TEXT"/>
        </createTable>
    </changeSet>
    <changeSet author="metadata" id="metadata-1.8.0_13">
        <addForeignKeyConstraint baseColumnNames="STEP_EXECUTION_ID" baseTableName="BATCH_STEP_EXECUTION_CONTEXT" constraintName="STEP_EXEC_CTX_FK" deferrable="false" initiallyDeferred="false" onDelete="NO ACTION" onUpdate="NO ACTION" referencedColumnNames="STEP_EXECUTION_ID" referencedTableName="BATCH_STEP_EXECUTION" validate="true"/>
    </changeSet>

    <changeSet author="metadata" id="metadata-1.8.0_14">
        <createTable tableName="BATCH_JOB_EXECUTION_CONTEXT">
            <column name="JOB_EXECUTION_ID" type="BIGINT">
                <constraints primaryKey="true"/>
            </column>
            <column name="SHORT_CONTEXT" type="VARCHAR(2500)">
                <constraints nullable="false"/>
            </column>
            <column name="SERIALIZED_CONTEXT" type="TEXT"/>
        </createTable>
    </changeSet>
    <changeSet author="metadata" id="metadata-1.8.0_15">
        <addForeignKeyConstraint baseColumnNames="JOB_EXECUTION_ID" baseTableName="BATCH_JOB_EXECUTION_CONTEXT" constraintName="JOB_EXEC_CTX_FK" deferrable="false" initiallyDeferred="false" onDelete="NO ACTION" onUpdate="NO ACTION" referencedColumnNames="JOB_EXECUTION_ID" referencedTableName="BATCH_JOB_EXECUTION" validate="true"/>
    </changeSet>

    <changeSet author="metadata" id="metadata-1.8.0_16">
        <createTable tableName="BATCH_STEP_EXECUTION_SEQ">
            <column name="ID" type="BIGINT">
                <constraints nullable="false"/>
            </column>
            <column name="UNIQUE_KEY" type="CHAR(1)">
                <constraints nullable="false" unique="true"/>
            </column>
        </createTable>
    </changeSet>
    <changeSet author="metadata" id="metadata-1.8.0_17">
        <insert tableName="BATCH_STEP_EXECUTION_SEQ">
            <column name="ID">0</column>
            <column name="UNIQUE_KEY">0</column>
        </insert>
    </changeSet>

    <changeSet author="metadata" id="metadata-1.8.0_18">
        <createTable tableName="BATCH_JOB_EXECUTION_SEQ">
            <column name="ID" type="BIGINT">
                <constraints nullable="false"/>
            </column>
            <column name="UNIQUE_KEY" type="CHAR(1)">
                <constraints nullable="false" unique="true"/>
            </column>
        </createTable>
    </changeSet>
    <changeSet author="metadata" id="metadata-1.8.0_19">
        <insert tableName="BATCH_JOB_EXECUTION_SEQ">
            <column name="ID">0</column>
            <column name="UNIQUE_KEY">0</column>
        </insert>
    </changeSet>

    <changeSet author="metadata" id="metadata-1.8.0_20">
        <createTable tableName="BATCH_JOB_SEQ">
            <column name="ID" type="BIGINT">
                <constraints nullable="false"/>
            </column>
            <column name="UNIQUE_KEY" type="CHAR(1)">
                <constraints nullable="false" unique="true"/>
            </column>
        </createTable>
    </changeSet>
    <changeSet author="metadata" id="metadata-1.8.0_21">
        <insert tableName="BATCH_JOB_SEQ">
            <column name="ID">0</column>
            <column name="UNIQUE_KEY">0</column>
        </insert>
    </changeSet>

    <!-- for auth -->
    <changeSet author="metadata" id="metadata-1.8.0_22">
        <createTable tableName="nss_auth_override_user">
            <column name="user_id" type="CHAR(7)">
                <constraints primaryKey="true"/>
            </column>
        </createTable>
    </changeSet>

    <changeSet author="metadata" id="metadata-1.8.0_23">
        <createTable tableName="nss_auth_prefix">
            <column name="prefix" type="VARCHAR(7)">
                <constraints primaryKey="true"/>
            </column>
        </createTable>
    </changeSet>

    <changeSet author="metadata" id="metadata-1.8.0_24">
        <createTable tableName="paas_organization">
            <column autoIncrement="true" name="number" type="INT UNSIGNED">
                <constraints primaryKey="true"/>
            </column>
            <column name="organization" type="VARCHAR(50)">
                <constraints nullable="false" unique="true"/>
            </column>
            <column name="databaseName" type="VARCHAR(30)">
                <constraints nullable="false"/>
            </column>
            <column name="hbaseNameSpace" type="VARCHAR(30)">
                <constraints nullable="false"/>
            </column>
        </createTable>
    </changeSet>
</databaseChangeLog>